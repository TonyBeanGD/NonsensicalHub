# PC项目转WebGL平台开发指导说明文档

软件环境：Unity2018.1.1f1,VS2017  

打包WebGL平台时，由于程序是在浏览器上运行的，所以在运行内存，gpu等的使用方面有着更为严苛的性能要求，同时由于html对计算机本地文件的访问限制，存在着跨域的问题。

* 转平台后不能使用的特性  

  1. c#的反射，会直接报错无法运行  
  2. dllimport语句，会直接报错无法运行  
  3. C#的Socket,必须使用WebSocket代替Socket进行连接

* 转平台后有问题的插件

  1. PostProcessing后处理插件，在WebGL平台运行时会报警告提示无法使用，猜测是Unity官方在2018.1.1f1中并没有添加对webGL平台的支持（考虑到webGL上的显示效果限制，应当为了性能抛弃一部分显示效果）  
  2. HighlightSystem高光插件，在WebGL平台上运行时，和编辑器环境下的显示效果不一致。

* 跨域读取文件问题的解决方法
  
  1. C#的读取本地文件的方法都无法使用，必须使用http的方法来获取本地文件。可以使用Unity提供的UnityWebRequest来实现本地文件的读取，Application.StreamingAsset的之类的Unity提供的路径仍然可以使用

* 其他注意事项

  1. 当运行场景需要的运行内存超过限制时，会直接提示内存超出无法运行
  2. 当待加载的场景内存超过限制时，加载场景语句会直接失效（没有任何Log）  
  3. 开始运行的加载特效修改需要自己编写html内容  
  
* 优化手段

  1. 使用减面后的模型  
  多面的模型会占用较多的运行内存，为了适应webgl平台对内存的要求，应当抛弃一部分显示效果，使用减面后的模型  
  2. 对贴图进行压缩，Mip Maps不必要时应当不适用  
  对贴图进行压缩可以有效降低内存消耗，合理使用Mip Maps可以有效减小显存消耗，但是当其不会产生作用时（场景较小时或者一直和摄像机保持较近距离的模型贴图），会占用多余的内存
  3. 不使用过于复杂的光效，特别是反射效果  
  关闭所有灯光，仅使用物体自带光照贴图，可以使得在效果能够的范围内有效减少光照贴图的内存消耗
  4. 自己编写webgl打包模板  
  在网上查阅相关资料，编写一个html模板来在playerSetting中使用，就可以自定义加载动画了  

webgl:
VideoPlay使用Resources内资源会报错（可能和中文名有关，未测试，图片类资源使用中文名无报错）
RectMask2D无法生效
视频转换成ogv
litjson使用时可能出现bug（无法序列化引用类型）  

不支持中文输入，默认字体无法显示中文，使用Path.Combine会导致文字转码，视频无法使用VideoClip,RectMask2D组件无法生效，litjson无法序列化引用类型
